<link rel="stylesheet" href="/static/style/profile-edit.css">

<div class="edit-profile-page">
    <div class="page-header">
        <button class="btn btn-back" data-content="profile">
            <i class="fas fa-arrow-left"></i> Назад к профилю
        </button>
        <h2>Смена пароля</h2>
    </div>

    <div class="edit-form-container">
        <form id="passwordForm" class="profile-form">
            <div class="form-section">
                <h3>Безопасность аккаунта</h3>
                <p class="security-info">Для смены пароля необходимо подтвердить текущий пароль и установить новый.</p>
                
                <div class="form-group">
                    <label for="current-password">Текущий пароль *</label>
                    <input type="password" id="current-password" name="current_password" 
                           autocomplete="current-password" required minlength="5" maxlength="50">
                </div>
                
                <div class="form-group">
                    <label for="new-password">Новый пароль *</label>
                    <input type="password" id="new-password" name="new_password" 
                           autocomplete="new-password" required minlength="5" maxlength="50">
                    <small class="form-text">От 5 до 50 символов</small>
                </div>
                
                <div class="form-group">
                    <label for="confirm-password">Подтверждение пароля *</label>
                    <input type="password" id="confirm-password" name="confirm_password" 
                           autocomplete="new-password" required minlength="5" maxlength="50">
                    <div id="password-match" class="availability-status"></div>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" data-content="profile">Отмена</button>
                <button type="submit" class="btn btn-primary" data-action="change-password">Сменить пароль</button>
            </div>
        </form>
    </div>
</div>

<script src="/static/js/profile-edit.js"></script>
<script>

function initializePasswordFormHandlers() {
    // Проверка совпадения паролей
    const confirmPasswordInput = document.getElementById('confirm-password');
    if (confirmPasswordInput) {
        confirmPasswordInput.addEventListener('input', checkPasswordMatch);
    }

    // Обработчик формы
    const form = document.getElementById('passwordForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const submitButton = this.querySelector('[data-action="change-password"]');
            if (submitButton) {
                handleAction('change-password', submitButton, e);
            }
        });
    }
}

function checkPasswordMatch() {
    const newPassword = document.getElementById('new-password')?.value || '';
    const confirmPassword = this.value;
    const statusElement = document.getElementById('password-match');
    
    if (!statusElement) return;
    
    if (confirmPassword && newPassword !== confirmPassword) {
        statusElement.innerHTML = '<span class="text-danger">✗ Пароли не совпадают</span>';
    } else if (confirmPassword && newPassword === confirmPassword) {
        statusElement.innerHTML = '<span class="text-success">✓ Пароли совпадают</span>';
    } else {
        statusElement.innerHTML = '';
    }
}
</script>